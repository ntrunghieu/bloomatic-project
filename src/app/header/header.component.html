<header class="site-header">
  <div class="bar">
    <a class="brand" [routerLink]="['/']" href="/">
      <img src="assets/logomini.jpeg" alt="BloomCinema" />
      <span class="kv">ฤแบทt vรฉ<br /><b>xem phim</b></span>
    </a>
    <nav class="main-nav">
      <a [routerLink]="['/schedule']" href="#">Lแปch chiแบฟu</a>
      <a href="#">Rแบกp chiแบฟu</a>
      <a href="#">Phim chiแบฟu</a>
      <a href="#">Review phim</a>
      <a href="#">Top phim</a>
      <a href="#">Blog phim</a>
    </nav>

    <div class="header-actions">

      <!-- ===== Khi CHฦฏA ฤฤng nhแบญp ===== -->
      <ng-container *ngIf="!user; else loggedIn">
        <button class="auth-btn outline" (click)="openRegister()">ฤฤng kรฝ</button>
        <button class="auth-btn primary" (click)="openLogin()">ฤฤng nhแบญp</button>
        <button class="icon-btn" aria-label="Tรฌm kiแบฟm" (click)="toggleSearch()">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </ng-container>

      <!-- ===== Khi ฤร ฤฤng nhแบญp ===== -->
      <ng-template #loggedIn>
        <div class="user-menu">
          <button class="user-chip" (click)="toggleMenu()">
            <span class="avatar"><i class="fa-solid fa-user"></i></span>
            <span class="name">{{ user?.fullName || user?.email }}</span>
            <i class="fa-solid fa-chevron-down caret" [class.open]="menuOpen"></i>
          </button>

          <div class="dropdown" *ngIf="menuOpen" (click)="$event.stopPropagation()">
            <a class="item" [routerLink]="['/account/profile']" (click)="closeMenu()">Thรดng tin tรi khoแบฃn</a>
            <a class="item" [routerLink]="['/account/change-password']" (click)="closeMenu()">ฤแปi mแบญt khแบฉu</a>
            <a class="item" [routerLink]="['/account/orders']" (click)="closeMenu()">Lแปch sแปญ mua vรฉ</a>
          </div>
        </div>

        <button class="auth-btn outline" (click)="logout()">ฤฤng xuแบฅt</button>
        <button class="icon-btn" aria-label="Tรฌm kiแบฟm" (click)="toggleSearch()">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </ng-template>

      <!-- <button class="auth-btn outline" (click)="openRegister()">
        ฤฤng kรฝ
      </button>
      <button class="auth-btn primary" (click)="openLogin()">
        ฤฤng nhแบญp
      </button> -->

      <!-- <button hidden class="icon-btn" aria-label="Tรฌm kiแบฟm" (click)="toggleSearch()">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button> -->
    </div>

    <!-- <button class="icon-btn" aria-label="Tรฌm kiแบฟm" (click)="toggleSearch()">
      <i class="fa-solid fa-magnifying-glass"></i>
    </button> -->
  </div>

  <!-- Overlay lรm mแป nแปn -->
  <div class="overlay" *ngIf="searchOpen" (click)="closeSearch()"></div>

  <!-- Popover tรฌm kiแบฟm -->
  <div class="search-pop" *ngIf="searchOpen" (click)="$event.stopPropagation()">
    <div class="caret"></div>

    <form class="searchbox" (submit)="submit()">
      <span class="icon"><i class="fa-solid fa-magnifying-glass"></i></span>
      <input type="text" [(ngModel)]="q" name="q" placeholder="Nhแบญp tรชn phim" autofocus />
      <button type="button" class="clear" *ngIf="q" (click)="q=''">โ</button>
    </form>

    <div class="panel-scroll">
      <div class="section">
        <div class="sec-title">TรM KIแบพM GแบฆN ฤรY</div>
        <div class="recent" *ngFor="let r of recent">
          <span class="arrow"><i class="fa-solid fa-arrow-right"></i></span> {{ r }}
        </div>
      </div>

      <div class="divider"></div>

      <div class="section">
        <div class="sec-title">PHIM ฤANG CHIแบพU</div>

        <a class="movie" *ngFor="let m of nowShowing" href="#">
          <img class="thumb" [src]="m.poster" [alt]="m.title" />
          <div class="info">
            <div class="title">{{ m.title }}</div>
            <div class="genres">{{ m.genres }}</div>
            <div class="meta">
              <span class="star">โ</span>{{ m.rating.toFixed(1) }}
              <span class="badge" *ngIf="m.nowPlaying">๐ด ฤANG CHIแบพU</span>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</header>

<nav class="breadcrumb" aria-label="Breadcrumb">
  <a href="/"><i class="fa-solid fa-house"></i></a>
  <span>โบ</span>
  <a href="/cinema">Cinema</a>
  <span>โบ</span>
  <span aria-current="page">Phim chiแบฟu</span>
</nav>

<!-- MODAL ฤฤNG NHแบฌP / ฤฤNG Kร -->
<div class="auth-backdrop" *ngIf="authModalOpen" (click)="closeAuth()">
  <div class="auth-modal" (click)="$event.stopPropagation()">
    <button class="auth-close" type="button" (click)="closeAuth()">ร</button>

    <ng-container [ngSwitch]="authMode">

      <!-- ===== ฤฤNG NHแบฌP ===== -->
      <!-- <form *ngSwitchCase="'login'" [formGroup]="loginForm" (ngSubmit)="submitLogin()" #loginForm="ngForm"> -->

      <form *ngSwitchCase="'login'" [formGroup]="loginModel" (ngSubmit)="submitLogin()">
        <h2>ฤฤng nhแบญp</h2>

        <button type="button" class="auth-google-btn">
          <i class="fa-brands fa-google"></i>
          ฤฤng nhแบญp vแปi Google
        </button>

        <div class="auth-divider">HOแบถC</div>

        <div class="auth-form-field">
          <label>Email</label>
          <input type="email" name="loginEmail" formControlName="email" required />
        </div>

        <div class="auth-form-field">
          <label>Mแบญt khแบฉu</label>
          <input type="password" name="loginPassword" formControlName="password" required />
        </div>

        <div class="auth-extra">
          <a href="#" class="forgot-link">Quรชn mแบญt khแบฉu?</a>
        </div>

        <button class="auth-submit" type="submit">
          ฤฤng nhแบญp
        </button>

        <div class="auth-switch">
          <span>Bแบกn chฦฐa cรณ tรi khoแบฃn? </span>
          <button type="button" class="link-btn" (click)="openRegister()">
            ฤฤng kรฝ?
          </button>
        </div>
      </form>

      <!-- ===== ฤฤNG Kร ===== -->
      <form *ngSwitchCase="'register'" (ngSubmit)="submitRegister()" #registerForm="ngForm">
        <h2>ฤฤng kรฝ</h2>

        <div class="auth-form-field">
          <label>Hแป tรชn</label>
          <input type="text" name="fullName" [(ngModel)]="registerModel.fullName" required />
        </div>

        <div class="auth-form-grid-2">
          <div class="auth-form-field">
            <label>Email</label>
            <input type="email" name="regEmail" [(ngModel)]="registerModel.email" required />
          </div>
          <div class="auth-form-field">
            <label>Sแป ฤiแปn thoแบกi</label>
            <input type="tel" name="phone" [(ngModel)]="registerModel.phone" />
          </div>
        </div>

        <div class="auth-form-field">
          <label>Mแบญt khแบฉu</label>
          <input type="password" name="regPassword" [(ngModel)]="registerModel.password" required />
        </div>

        <div class="auth-form-field">
          <label>Xรกc nhแบญn mแบญt khแบฉu</label>
          <input type="password" name="confirmPassword" [(ngModel)]="registerModel.confirmPassword" required />
        </div>

        <button class="auth-submit" type="submit">
          ฤฤng kรฝ
        </button>

        <div class="auth-switch">
          <span>Bแบกn ฤรฃ cรณ tรi khoแบฃn? </span>
          <button type="button" class="link-btn" (click)="openLogin()">
            ฤฤng nhแบญp?
          </button>
        </div>
      </form>
    </ng-container>
  </div>
</div>